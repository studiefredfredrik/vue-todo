<template>
  <transition name="modal-fade">
    <div class="modal-backdrop" >
      <div class="modal" role="dialog">
        <div class="wrapper" v-on:click="close">
          <span class="close"></span>
        </div>

        <!-- Blog entry -->
        <div class="w3-card-4 w3-margin w3-white ">
          <img src="/w3images/bridge.jpg" alt="Norway" style="width:100%">
          <croppa v-model="post.image.myCroppa"
                  :width="700"
                  :height="220"
          ></croppa>
          <div class="w3-container">
            <input type="text" v-if="post.heading.editing" v-on:blur="post.heading.editing = false;" v-model="post.heading.text"/>
            <h3><b v-if="!post.heading.editing" v-on:click="post.heading.editing = true;">{{post.heading.text}}</b></h3>
            <input type="text" v-if="post.undertitle.editing" v-on:blur="post.undertitle.editing = false;" v-model="post.undertitle.text"/>
            <h5 v-if="!post.undertitle.editing" v-on:click="post.undertitle.editing = true;">{{post.undertitle.text}}</h5>
          </div>

          <div class="w3-container">
            <input type="text" class="widt100" v-if="post.description.editing" v-on:blur="post.description.editing = false;" v-model="post.description.text"/>
            <p id="description" v-if="!post.description.editing" v-on:click="post.description.editing = true;">
              {{post.description.text}}
            </p>

            <input class="widt100" type="text" v-if="post.more.editing" v-on:blur="post.more.editing = false;" v-model="post.more.text"/>
            <p v-if="!post.more.editing" v-on:click="post.more.editing = true;">
              {{post.more.text}}
            </p>
            <br>
          </div>

          <div class="w3-container">
            <div class="w3-row">
              <div class="w3-col m8 s12">
                <p><button class="w3-button w3-padding-large w3-white w3-border" @click="savePost()"><b>Save</b></button></p>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </transition>
</template>

<script>
  import axios from 'axios';

  export default {
    name: 'modal',
    data: function() {
      return {}
    },
    props: {
      post:{
        default: () => ({
          image: {
            myCroppa: {},
            image: null,
            editing: false,
          },
          heading: {
            text: `BLOG ENTRY`,
            editing: false,
          },
          undertitle: {
            text: `Praesent tincidunt sed`,
            editing: false,
          },
          description: {
            text: `Mauris neque quam, fermentum ut nisl vitae, convallis maximus nisl.
                  Sed mattis nunc id lorem euismod placerat.
                  Vivamus porttitor magna enim, ac accumsan tortor cursus at. Phasellus sed ultricies mi non congue ullam corper.
                  Praesent tincidunt sed
                  tellus ut rutrum. Sed vitae justo condimentum, porta lectus vitae, ultricies congue gravida diam non fringilla.`,
            editing: false,
          },
          more: {
            text: `Even more info here, with more details etc. And more more more`,
            editing: false,
          },
        })
      }
    },
    methods: {
      savePost: function(){
        console.log(this.post.image.myCroppa.generateDataUrl());

        let post = {
          image: this.post.image.myCroppa.generateDataUrl(),
          heading: this.post.heading.text,
          undertitle: this.post.undertitle.text,
          description: this.post.description.text,
          more: this.post.more.text,
          type: 'equipment'
        }
        console.log('post', post);

        axios.post(`/api/Notes?password=PeopleCantPostWithoutPlaying`, post)
          .then(response => {
            // JSON responses are automatically parsed.
            window.location.href = '/';
          })
          .catch(e => {
            this.errors.push(e)
          })
      },
      close() {
        this.$emit('close');
      },
    },
  }
</script>

<style>
  .wrapper {
    position: relative;
    display: inline-block;
  }
  .close:before {
    content: 'âœ•';
  }
  .close {
    position: absolute;
    top: 0;
    right: 4px;
    cursor: pointer;
  }

  .modal{
    width: 732px;
  }

  .widt100{
    width: 100%;
  }

  .modal-backdrop {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    background-color: rgba(0, 0, 0, 0.3);
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .modal {
    background: #FFFFFF;
    box-shadow: 2px 2px 20px 1px;
    overflow-x: auto;
    display: flex;
    flex-direction: column;
  }

  .modal-header,
  .modal-footer {
    padding: 15px;
    display: flex;
  }

  .modal-header {
    border-bottom: 1px solid #eeeeee;
    color: #4AAE9B;
    justify-content: space-between;
  }

  .modal-footer {
    border-top: 1px solid #eeeeee;
    justify-content: flex-end;
  }

  .modal-body {
    position: relative;
    padding: 20px 10px;
  }

  .btn-close {
    border: none;
    font-size: 20px;
    padding: 20px;
    cursor: pointer;
    font-weight: bold;
    color: #4AAE9B;
    background: transparent;
  }

  .btn-green {
    color: white;
    background: #4AAE9B;
    border: 1px solid #4AAE9B;
    border-radius: 2px;
  }
</style>
